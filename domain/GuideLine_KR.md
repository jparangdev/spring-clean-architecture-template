# 도메인 모듈 (Domain)

## 개요

도메인 모듈은 클린 아키텍처의 가장 안쪽 레이어입니다. 핵심 비즈니스 모델과 규칙을 보유하며, 프레임워크·데이터베이스·UI로부터 독립적이어야 합니다. 비즈니스의 심장을 대표하며 기술적 변화에 대해 안정적입니다.

## 목적

- 순수 비즈니스 로직: 기술적 우려 없이 시스템이 무엇인지, 무엇을 할 수 있는지 정의
- 프레임워크 독립성: 자바 표준 라이브러리와 소규모 유틸리티만 사용
- 애그리게이트 루트 관리: 애그리게이트와 불변조건 모델링(DDD 원칙)
- 비즈니스 규칙 강제: 핵심 규칙을 엔티티와 값 객체 내부에서 보장

## 포함되는 것

- 도메인 엔티티: 핵심 비즈니스 객체(애그리게이트 루트 및 엔티티)
- 값 객체: 특성/개념을 표현하는 불변 타입
- 도메인 서비스: 단일 엔티티에 속하지 않는 도메인 로직
- 비즈니스 규칙과 불변조건
- 도메인 이벤트: 비즈니스적으로 의미 있는 사건

## 포함되지 않는 것

- 인프라 의존성: DB 접근, HTTP 클라이언트, 외부 서비스 호출
- 프레임워크 애노테이션/의존성(Spring, JPA, Jakarta EE 등)
- 프레젠테이션/UI 로직
- 애플리케이션 오케스트레이션(유스케이스, 트랜잭션)

## 의존성 규칙

### 허용되는 의존성
- 인프라를 노출하지 않는 범위의 유틸리티 라이브러리(예: Apache Commons, Guava)
- 자바 표준 라이브러리
- 불변 데이터 관련 라이브러리

### 금지되는 의존성
- 스프링 프레임워크 또는 DI/웹 애노테이션 전반
- JPA/Hibernate 등 영속성 관련 기술
- 웹 프레임워크(REST, MVC 등)
- 외부 서비스 클라이언트

## 설계 가이드라인

- 엔티티 설계
  - 엔티티는 비즈니스 행위에 집중(빈약한 도메인 모델 지양)
  - 불변성을 선호하고, 상태 변경은 의도를 드러내는 메서드로 노출
  - 생성자와 메서드에서 불변조건을 강제
- 애그리게이트 간 커뮤니케이션
  - 애그리게이트 간 조율은 도메인 이벤트를 우선 고려
  - 애그리게이트는 작고 응집력 있게, 일관성을 유지
- 비즈니스 규칙 구현
  - 규칙은 엔티티/값 객체의 메서드로 구현
  - 여러 엔티티/애그리게이트에 걸치는 로직은 도메인 서비스 사용

## 테스트 전략

- 프레임워크 없이 엔티티, 값 객체, 도메인 서비스를 단위 테스트
- 중요 불변조건과 값 객체는 속성 기반 테스트(optional)
- 도메인 이벤트 발생과 그에 따른 상태 변화를 검증

## 프로젝트 예시

- 본 프로젝트의 도메인 모델: Post, User, Comment
- 엔티티는 순수 자바 객체(보일러플레이트는 Lombok 사용, 프레임워크 애노테이션 없음)
- 비즈니스 메서드(예: Post.updateContent)가 규칙을 캡슐화

## 예시

```java
// 좋음: 도메인 엔티티 내부에 비즈니스 로직 포함
public class Post {
    // ... fields
    
    public void updateContent(String newContent) {
        if (newContent == null || newContent.trim().isEmpty()) {
            throw new IllegalArgumentException("Post content cannot be empty");
        }
        this.content = newContent;
        this.updatedAt = LocalDateTime.now();
    }
    
    public boolean canBeEditedBy(Long userId) {
        return this.authorId.equals(userId);
    }
}
```

## 모범 사례

- 데이터와 행위를 함께 두고, 세터 기반 상태 변경을 지양
- 도메인을 기술적 관심사로부터 격리; 프레임워크 import 금지
- 보편 언어(Ubiquitous Language)를 엔티티/값 객체로 명시적으로 모델링
- 작은, 의도를 드러내는 메서드로 규칙을 강제
- 애그리게이트 간 통신에는 도메인 이벤트를 선호
